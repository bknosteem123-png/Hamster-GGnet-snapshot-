<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Snapshot: Liminal</title>

<link href="https://fonts.googleapis.com/css2?family=Lalezar&family=Vazirmatn:wght@300;400;700&family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  /* --- Ù¾Ø§ÛŒÙ‡Ù” ØªÙ… Dreamcore (Ù…Ø«Ù„ Ù‚Ø¨Ù„) --- */
  :root{ --bg1:#06060a; --bg2:#111027; --card: rgba(18,18,30,0.6); --text:#e6e6ff; }
  html,body{height:100%; margin:0; padding:18px; direction:rtl; font-family:'Vazirmatn',sans-serif; background:linear-gradient(180deg,var(--bg1),var(--bg2)); color:var(--text);}
  .container{ max-width:980px; margin:0 auto; }
  h1{ font-family:'Lalezar',cursive; font-size:28px; margin:6px 0 14px; text-align:center; }
  .row{ display:flex; gap:12px; flex-wrap:wrap; justify-content:center; }
  .card{ background:var(--card); border-radius:12px; padding:12px; min-width:260px; box-shadow:0 8px 30px rgba(0,0,0,0.6); }
  #score{ font-size:28px; font-weight:700; text-align:center; margin-bottom:6px; }
  #gameSkin{ width:170px; height:170px; border-radius:18px; margin:12px auto; display:flex; align-items:center; justify-content:center; font-size:74px; background:rgba(255,255,255,0.02); cursor:pointer; box-shadow:0 10px 40px rgba(120,80,220,0.06); }
  button{ padding:8px 12px; border-radius:8px; border:none; background:rgba(255,255,255,0.03); color:var(--text); cursor:pointer; }
  button.small{ padding:6px 8px; font-size:13px; }
  .muted{ color:#bfbde7aa; font-size:13px; }
  .shopList{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:8px; }
  .skin{ width:86px; border-radius:10px; text-align:center; padding:8px; cursor:pointer; border:1px solid rgba(255,255,255,0.03); }
  .skin .emoji{ font-size:30px; display:block; }
  .skin.unlocked{ outline:2px solid rgba(150,110,255,0.12); }
  #codeDisplay{ margin-top:10px; color:#aaf; font-size:14px; display:none; }
  #codeDisplay strong{ letter-spacing:2px; font-size:16px; color:#fff; }
  .copyMsg{ color:#9fe6a3; font-size:13px; margin-top:6px; display:none; }
  select{ width:100%; padding:8px; border-radius:8px; background:rgba(255,255,255,0.02); color:var(--text); border:1px solid rgba(255,255,255,0.03); }
  @media (max-width:720px){ .row{ flex-direction:column; } }
</style>
</head>
<body>
<div class="container">
  <h1>Snapshot: Liminal</h1>
  <div id="score">0</div>

  <div id="gameSkin">ğŸŒŒ</div>

  <div class="row">
    <!-- Ø¨Ø§Ø²ÛŒ / Ø¢Ù¾Ú¯Ø±ÛŒØ¯Ù‡Ø§ -->
    <div class="card">
      <div style="text-align:center;">
        <button id="powerBtn">Ù‚Ø¯Ø±Øª Ú©Ù„ÛŒÚ© (+1) [15]</button>
        <button id="doubleBtn">Ø¯Ø§Ø¨Ù„ Û³Û°s [80]</button>
        <button id="autoClickBtn">Ø®Ø±ÛŒØ¯ Ú©Ù„ÛŒÚ©Ø± Ø®ÙˆØ¯Ú©Ø§Ø± [50]</button>
        <div id="doubleTimer" style="display:none; margin-top:8px;" class="muted">Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: <span id="doubleLeft">0</span>s</div>
      </div>

      <hr style="margin:12px 0; border:none; border-top:1px solid rgba(255,255,255,0.03)">

      <div>
        <h4 style="margin:6px 0;">Ø§Ø³Ú©ÛŒÙ†â€ŒÙ‡Ø§</h4>
        <div id="skins" class="shopList">
          <div class="skin" data-emoji="ğŸŒŒ" data-cost="0"><span class="emoji">ğŸŒŒ</span><div class="muted">Ø¢Ø³Ù…Ø§Ù† Ø¨ÛŒâ€ŒÙ¾Ø§ÛŒØ§Ù†<br>Ø±Ø§ÛŒÚ¯Ø§Ù†</div></div>
          <div class="skin" data-emoji="ğŸª" data-cost="60"><span class="emoji">ğŸª</span><div class="muted">Ø¢ÛŒÙ†Ù‡ â€” Û¶Û°</div></div>
          <div class="skin" data-emoji="ğŸšª" data-cost="90"><span class="emoji">ğŸšª</span><div class="muted">Ø¯Ø± â€” Û¹Û°</div></div>
          <div class="skin" data-emoji="ğŸ•¯ï¸" data-cost="120"><span class="emoji">ğŸ•¯ï¸</span><div class="muted">Ø´Ù…Ø¹ â€” Û±Û²Û°</div></div>
          <div class="skin" data-emoji="ğŸŒ€" data-cost="200"><span class="emoji">ğŸŒ€</span><div class="muted">Ø®Ù„Ø£ â€” Û²Û°Û°</div></div>
        </div>
      </div>
    </div>

    <!-- Ù…ÙˆØ²ÛŒÚ© -->
    <div class="card">
      <h4 style="margin:6px 0;">Ù…ÙˆØ²ÛŒÚ©</h4>
      <div class="muted">Ambient Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù¾Ø®Ø´ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù¾Ø³ Ø§Ø² Ø®Ø±ÛŒØ¯ Ø±Ø§Ø¯ÛŒÙˆØŒ Ù…ÙˆØ²ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</div>
      <div style="margin-top:8px;">
        <button id="buyMusicBtn">Ø®Ø±ÛŒØ¯ Ø±Ø§Ø¯ÛŒÙˆ [120]</button>
        <div style="margin-top:8px;">
          <select id="musicList" disabled>
            <option value="music1.mp3">Ø¢Ù‡Ù†Ú¯ Û±</option>
            <option value="music2.mp3">Ø¢Ù‡Ù†Ú¯ Û²</option>
            <option value="music3.mp3">Ø¢Ù‡Ù†Ú¯ Û³</option>
            <option value="music4.mp3">Ø¢Ù‡Ù†Ú¯ Û´</option>
            <option value="music5.mp3">Ø¢Ù‡Ù†Ú¯ Ûµ</option>
            <option value="music6.mp3">Ø¢Ù‡Ù†Ú¯ Û¶</option>
          </select>
          <div style="margin-top:8px;"><button id="playMusicBtn" disabled>Ù¾Ø®Ø´ / ØªÙˆÙ‚Ù</button></div>
        </div>
      </div>
    </div>

    <!-- ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
    <div class="card">
      <h4 style="margin:6px 0;">ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h4>
      <div class="shopList">
        <div class="skin" id="houseItem" data-cost="100000"><span class="emoji">ğŸ </span><div class="muted">Ø®Ø§Ù†Ù‡ â€” Û±Û°Û°Ù¬Û°Û°Û°</div></div>
      </div>
      <div id="codeDisplay" aria-live="polite">
        <!-- Ú©Ø¯ Ùˆ Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ -->
      </div>
      <div class="copyMsg" id="copyMsg">Ú©Ø¯ Ú©Ù¾ÛŒ Ø´Ø¯!</div>
    </div>

    <!-- ÙÙˆÙ†Øª Ùˆ Ø°Ø®ÛŒØ±Ù‡ -->
    <div class="card">
      <h4 style="margin:6px 0;">ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ & Ø°Ø®ÛŒØ±Ù‡</h4>
      <div style="display:flex; flex-direction:column; gap:8px; align-items:center;">
        <button class="fontBtn" data-font="'Lalezar', cursive" data-cost="160">ÙÙˆÙ†Øª Ù„ÙÛŒØ²Ø§Ø± [Û±Û¶Û°]</button>
        <button class="fontBtn" data-font="'Vazirmatn', sans-serif" data-cost="0">ÙÙˆÙ†Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ [Ø±Ø§ÛŒÚ¯Ø§Ù†]</button>
        <button class="fontBtn" data-font="'Press Start 2P', monospace" data-cost="500">ÙÙˆÙ†Øª Ù…Ø±Ø¨Ø¹ÛŒ/Ú¯Ù„ÛŒÚ†ÛŒ [ÛµÛ°Û°]</button>
      </div>

      <div style="margin-top:12px;">
        <button id="saveBtn">Ø°Ø®ÛŒØ±Ù‡</button>
        <button id="restartBtn">Ø±ÛŒØ³ØªØ§Ø±Øª</button>
      </div>
    </div>
  </div>

  <footer style="text-align:center; margin-top:14px;" class="muted">Ù†Ø³Ø®Ù‡Ù” Snapshot â€” ØªÙ… Liminal</footer>
</div>

<!-- ØµØ¯Ø§Ù‡Ø§ -->
<audio id="ambient" loop preload="auto" src="ambient.mp3"></audio>
<audio id="musicPlayer" preload="auto"></audio>
<audio id="clickSound" preload="auto" src="click1.mp3"></audio>

<script>
/* ---------- ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ ---------- */
let score = 0;
let clickPower = 1;
let doubleActive = false;
let doubleExpiresAt = 0;
let musicUnlocked = false;
let musicPlaying = false;
let autoClickLevel = 0;
let autoClickInterval = null;
let houseCode = null;

/* ---------- Ø¹Ù†Ø§ØµØ± ---------- */
const scoreEl = document.getElementById('score');
const gameSkin = document.getElementById('gameSkin');
const powerBtn = document.getElementById('powerBtn');
const doubleBtn = document.getElementById('doubleBtn');
const doubleTimer = document.getElementById('doubleTimer');
const doubleLeft = document.getElementById('doubleLeft');
const autoClickBtn = document.getElementById('autoClickBtn');
const buyMusicBtn = document.getElementById('buyMusicBtn');
const musicList = document.getElementById('musicList');
const playMusicBtn = document.getElementById('playMusicBtn');
const ambient = document.getElementById('ambient');
const musicPlayer = document.getElementById('musicPlayer');
const houseItem = document.getElementById('houseItem');
const codeDisplay = document.getElementById('codeDisplay');
const copyMsg = document.getElementById('copyMsg');
const skinsContainer = document.getElementById('skins');
const fontBtns = Array.from(document.querySelectorAll('.fontBtn'));
const saveBtn = document.getElementById('saveBtn');
const restartBtn = document.getElementById('restartBtn');
const clickSound = document.getElementById('clickSound');

/* ---------- Ú©Ù…Ú©ÛŒ ---------- */
function fmt(n){ return n>=1000 ? (n/1000).toFixed(1)+'k' : String(Math.floor(n)); }
function refreshScore(){ scoreEl.textContent = fmt(score); }

/* ---------- Ú©Ù„ÛŒÚ© Ø¯Ø³ØªÛŒ ---------- */
gameSkin.addEventListener('click', (e)=>{
  score += clickPower;
  refreshScore();
  try{ clickSound.currentTime = 0; clickSound.play().catch(()=>{}); }catch(e){}
  // ripple Ø³Ø§Ø¯Ù‡
  const r = document.createElement('span');
  r.style.position='absolute'; r.style.width=r.style.height='140px'; r.style.borderRadius='50%';
  r.style.left=(e.offsetX)+'px'; r.style.top=(e.offsetY)+'px';
  r.style.transform='translate(-50%,-50%) scale(0.1)'; r.style.background='radial-gradient(circle, rgba(150,110,255,0.26), transparent 40%)';
  r.style.pointerEvents='none'; r.style.animation='ripple 700ms forwards';
  gameSkin.appendChild(r);
  r.addEventListener('animationend', ()=> r.remove());
});
/* ripple keyframes injection (so it works even if CSS above didn't include it) */
const style = document.createElement('style'); style.textContent = "@keyframes ripple{ to{ transform:translate(-50%,-50%) scale(2.6); opacity:0;} }"; document.head.appendChild(style);

/* ---------- Ø§Ø³Ú©ÛŒÙ†â€ŒÙ‡Ø§ (Ø¨Ø§Ø²Ú¯Ø´Øª) ---------- */
function skinsList(){
  return Array.from(skinsContainer.querySelectorAll('.skin'));
}
skinsList().forEach(skin=>{
  skin.addEventListener('click', ()=>{
    const emoji = skin.dataset.emoji;
    const cost = Number(skin.dataset.cost) || 0;
    if(skin.classList.contains('unlocked') || cost === 0){
      // Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø³Ú©ÛŒÙ†
      gameSkin.textContent = emoji;
      // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ØªØ£ÛŒÛŒØ¯ÛŒ
      gameSkin.animate([{transform:'scale(1)'},{transform:'scale(0.96)'},{transform:'scale(1)'}],{duration:200});
      saveGame();
      return;
    }
    if(score >= cost){
      score -= cost; refreshScore();
      skin.classList.add('unlocked');
      // Ø®ÙˆØ¯ Ø¨Ù‡ Ø®ÙˆØ¯ Ø§Ø³Ú©ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯
      gameSkin.textContent = emoji;
      saveGame();
      // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØºØ§Ù… Ø¯Ø±ÙˆÙ† ØµÙØ­Ù‡ (Ø¨Ø¯ÙˆÙ† alert) â€” Ú©ÙˆØªØ§Ù‡
      const tmp = document.createElement('div'); tmp.textContent = 'Ø§Ø³Ú©ÛŒÙ† Ø®Ø±ÛŒØ¯Ù‡ Ø´Ø¯'; tmp.className='muted'; skin.appendChild(tmp);
      setTimeout(()=> tmp.remove(), 1100);
    } else {
      // Ù¾ÛŒØºØ§Ù… Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ú©Ø§ÙÛŒ Ø¨ÙˆØ¯Ù†
      const tmp = document.createElement('div'); tmp.textContent = 'Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª'; tmp.className='muted'; skin.appendChild(tmp);
      setTimeout(()=> tmp.remove(), 1100);
    }
  });
});

/* ---------- Ø§Ø±ØªÙ‚Ø§ Ù‚Ø¯Ø±Øª Ú©Ù„ÛŒÚ© ---------- */
powerBtn.addEventListener('click', ()=>{
  const COST = 15;
  if(score >= COST){ score -= COST; clickPower++; refreshScore(); saveGame(); alert('Ù‚Ø¯Ø±Øª Ú©Ù„ÛŒÚ© Ø¨ÛŒØ´ØªØ± Ø´Ø¯!'); }
  else alert('Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ.');
});

/* ---------- Ø¯Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ©Ø± ---------- */
doubleBtn.addEventListener('click', ()=>{
  const COST = 80;
  if(doubleActive){ alert('Ø¯Ø§Ø¨Ù„ ÙØ¹Ø§Ù„Ù‡'); return; }
  if(score >= COST){
    score -= COST; refreshScore();
    doubleActive = true; doubleExpiresAt = Date.now() + 30_000;
    clickPower *= 2; doubleTimer.style.display='block'; saveGame();
    alert('Ø¯Ø§Ø¨Ù„ ÙØ¹Ø§Ù„ Ø´Ø¯!');
  } else alert('Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ.');
});
setInterval(()=>{
  if(doubleActive){
    const left = Math.max(0, Math.ceil((doubleExpiresAt - Date.now())/1000));
    doubleLeft.textContent = left;
    if(left <= 0){ doubleActive=false; clickPower = Math.max(1, Math.floor(clickPower/2)); doubleTimer.style.display='none'; saveGame(); }
  }
}, 500);

/* ---------- Ú©Ù„ÛŒÚ©Ø± Ø®ÙˆØ¯Ú©Ø§Ø± ---------- */
function autoClickCost(level){ return 50 * (level + 1); }
function refreshAutoBtn(){ autoClickBtn.textContent = autoClickLevel === 0 ? `Ø®Ø±ÛŒØ¯ Ú©Ù„ÛŒÚ©Ø± Ø®ÙˆØ¯Ú©Ø§Ø± [${autoClickCost(0)}]` : `Ø§Ø±ØªÙ‚Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± (Ø³Ø·Ø­ ${autoClickLevel}) [${autoClickCost(autoClickLevel)}]`; }
refreshAutoBtn();
autoClickBtn.addEventListener('click', ()=>{
  const cost = autoClickCost(autoClickLevel);
  if(score >= cost){
    score -= cost; autoClickLevel++; refreshAutoBtn(); startAutoClicker(); refreshScore(); saveGame();
    alert('Ú©Ù„ÛŒÚ©Ø± Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØª!');
  } else alert('Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ.');
});
function startAutoClicker(){
  if(autoClickInterval) clearInterval(autoClickInterval);
  const interval = Math.max(400, 2000 - (autoClickLevel - 1) * 300);
  autoClickInterval = setInterval(()=>{ score += clickPower; refreshScore(); }, interval);
}

/* ---------- Ù…ÙˆØ²ÛŒÚ© (Ambient Ù¾ÛŒØ´â€ŒÙØ±Ø¶) ---------- */
const COST_MUSIC = 120;
buyMusicBtn.addEventListener('click', ()=>{
  if(musicUnlocked){ /* Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ù¾ÛŒØºØ§Ù… Ø¯Ø±ÙˆÙ† ØµÙØ­Ù‡ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯ */ return; }
  if(score >= COST_MUSIC){
    score -= COST_MUSIC; refreshScore();
    musicUnlocked = true;
    ambient.pause(); // Ù‚Ø·Ø¹ ambient
    musicList.disabled = false; playMusicBtn.disabled = false;
    saveGame();
    // Ù†Ù…Ø§ÛŒØ´ Ú©ÙˆØªØ§Ù‡ Ø¯Ø§Ø®Ù„ Ú©Ø§Ø±Øª
    const tmp = document.createElement('div'); tmp.textContent = 'Ø±Ø§Ø¯ÛŒÙˆ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯'; tmp.className='muted';
    buyMusicBtn.parentElement.appendChild(tmp); setTimeout(()=> tmp.remove(), 1200);
  } else {
    const tmp = document.createElement('div'); tmp.textContent = 'Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª'; tmp.className='muted';
    buyMusicBtn.parentElement.appendChild(tmp); setTimeout(()=> tmp.remove(), 1200);
  }
});
musicList.addEventListener('change', ()=>{ musicPlayer.src = musicList.value; if(musicPlaying) musicPlayer.play(); });
playMusicBtn.addEventListener('click', ()=>{
  if(!musicUnlocked) return;
  if(musicPlaying){ musicPlayer.pause(); musicPlaying = false; playMusicBtn.textContent = 'Ù¾Ø®Ø´ / ØªÙˆÙ‚Ù'; }
  else { musicPlayer.play().catch(()=>{}); musicPlaying = true; playMusicBtn.textContent = 'ØªÙˆÙ‚Ù'; }
});

/* ---------- ÙØ±ÙˆØ´Ú¯Ø§Ù‡: Ø®Ø§Ù†Ù‡ â€” Ù†Ù…Ø§ÛŒØ´ Ú©Ø¯ Ø¯Ø§Ø®Ù„ Ø³Ø§ÛŒØª (Ø¨Ø¯ÙˆÙ† alert/Ø±ÙØªÙ† Ø¨Ù‡ ØµÙØ­Ù‡) ---------- */
houseItem.addEventListener('click', ()=>{
  const cost = Number(houseItem.dataset.cost) || 0;
  if(houseItem.classList.contains('unlocked')) {
    // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø®Ø±ÛŒØ¯ Ø´Ø¯Ù‡ØŒ ÙÙ‚Ø· Ú©Ø¯ Ø±Ø§ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡ (Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª)
    if(houseCode) showHouseCode(houseCode);
    return;
  }
  if(score >= cost){
    score -= cost; refreshScore();
    houseItem.classList.add('unlocked');
    houseCode = Math.floor(1000 + Math.random() * 9000);
    showHouseCode(houseCode);
    saveGame();
    // ØªÙˆØ¬Ù‡: Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø² alert Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… (Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾)
  } else {
    // Ù¾ÛŒØ§Ù… Ú©ÙˆØªØ§Ù‡ Ø¯Ø±ÙˆÙ† Ú©Ø§Ø±Øª (Ù†Ù‡ alert)
    const tmp = document.createElement('div'); tmp.textContent = 'Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª'; tmp.className='muted';
    houseItem.appendChild(tmp); setTimeout(()=> tmp.remove(), 1100);
  }
});

function showHouseCode(code){
  codeDisplay.style.display = 'block';
  codeDisplay.innerHTML = `Ú©Ø¯ ÙˆÛŒÚ˜Ù‡ Ø´Ù…Ø§: <strong id="houseCodeValue">${code}</strong> <button id="copyCodeBtn" class="small">Ú©Ù¾ÛŒ</button>`;
  // Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ
  const copyBtn = document.getElementById('copyCodeBtn');
  copyBtn.addEventListener('click', async ()=>{
    try{
      if(navigator.clipboard && navigator.clipboard.writeText){
        await navigator.clipboard.writeText(String(code));
      } else {
        // fallback
        const ta = document.createElement('textarea'); ta.value = String(code); document.body.appendChild(ta);
        ta.select(); document.execCommand('copy'); ta.remove();
      }
      copyMsg.style.display = 'block';
      setTimeout(()=> copyMsg.style.display = 'none', 1400);
    }catch(e){
      // Ø¯Ø± Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾â€ŒÙ‡Ø§ Ù…Ù…Ú©Ù†Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¨Ø§Ø´Ù‡ â€” Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù¾ÛŒØ§Ù… Ø¯Ø±ÙˆÙ† ØµÙØ­Ù‡ Ø¨Ø¯ÛŒÙ…
      const tmp = document.createElement('div'); tmp.textContent = 'Ø§Ù…Ú©Ø§Ù† Ú©Ù¾ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯'; tmp.className='muted';
      codeDisplay.appendChild(tmp); setTimeout(()=> tmp.remove(), 1400);
    }
  }, { once:true });
}

/* ---------- ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ ---------- */
fontBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const cost = Number(btn.dataset.cost) || 0;
    const f = btn.dataset.font;
    if(cost > 0 && score < cost){
      const tmp = document.createElement('div'); tmp.textContent = 'Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª'; tmp.className='muted';
      btn.parentElement.appendChild(tmp); setTimeout(()=> tmp.remove(), 1100);
      return;
    }
    if(cost > 0){ score -= cost; refreshScore(); }
    document.body.style.fontFamily = f;
    saveGame();
    const tmp = document.createElement('div'); tmp.textContent = 'ÙÙˆÙ†Øª Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯'; tmp.className='muted';
    btn.parentElement.appendChild(tmp); setTimeout(()=> tmp.remove(), 900);
  });
});

/* ---------- Ø°Ø®ÛŒØ±Ù‡ / Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ---------- */
function saveGame(){
  try{
    const unlockedSkins = skinsList().filter(s=>s.classList.contains('unlocked')).map(s=>s.dataset.emoji);
    const data = {
      score, clickPower, doubleActive, doubleExpiresAt, musicUnlocked, autoClickLevel,
      houseUnlocked: houseItem.classList.contains('unlocked'), houseCode,
      unlockedSkins, currentSkin: gameSkin.textContent, font: document.body.style.fontFamily || ''
    };
    localStorage.setItem('snapshot_save', JSON.stringify(data));
  }catch(e){ console.warn('save err', e); }
}
function loadGame(){
  try{
    const raw = localStorage.getItem('snapshot_save'); if(!raw) return;
    const d = JSON.parse(raw);
    score = Number(d.score) || 0;
    clickPower = Number(d.clickPower) || 1;
    doubleActive = !!d.doubleActive; doubleExpiresAt = d.doubleExpiresAt || 0;
    musicUnlocked = !!d.musicUnlocked; autoClickLevel = Number(d.autoClickLevel) || 0;
    if(d.houseUnlocked){ houseItem.classList.add('unlocked'); houseCode = d.houseCode || null; if(houseCode) showHouseCode(houseCode); }
    if(Array.isArray(d.unlockedSkins)){
      skinsList().forEach(s => { if(d.unlockedSkins.includes(s.dataset.emoji)) s.classList.add('unlocked'); });
    }
    if(d.currentSkin) gameSkin.textContent = d.currentSkin;
    if(d.font) document.body.style.fontFamily = d.font;
    refreshScore(); refreshAutoBtn();
    if(autoClickLevel > 0) startAutoClicker();
    if(musicUnlocked){ musicList.disabled = false; playMusicBtn.disabled = false; ambient.pause(); }
    // Ø§Ú¯Ø± Ø¯Ø§Ø¨Ù„ Ù‚Ø¨Ù„Ø§Ù‹ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù‡ Ùˆ Ù‡Ù†ÙˆØ² Ø²Ù…Ø§Ù† Ù…ÙˆÙ†Ø¯Ù‡ØŒ Ù†Ø´ÙˆÙ† Ø¨Ø¯Ù‡
    if(doubleActive && Date.now() < (doubleExpiresAt || 0)){ doubleTimer.style.display='block'; }
    else { doubleActive = false; }
  }catch(e){ console.warn('load err', e); }
}

/* ---------- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø±ÛŒØ³ØªØ§Ø±Øª ---------- */
saveBtn.addEventListener('click', ()=>{ saveGame(); const tmp = document.createElement('div'); tmp.textContent = 'Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯'; tmp.className='muted'; saveBtn.parentElement.appendChild(tmp); setTimeout(()=> tmp.remove(), 900); });
restartBtn.addEventListener('click', ()=>{ if(confirm('Ø±ÛŒØ³ØªØŸ')){ localStorage.removeItem('snapshot_save'); location.reload(); } });

/* ---------- Ø´Ø±ÙˆØ¹ ---------- */
window.addEventListener('load', ()=>{
  ambient.volume = 0.55;
  ambient.play().catch(()=>{}); // Ù…Ù…Ú©Ù†Ù‡ autoplay Ø¨Ù„Ø§Ú© Ø¨Ø§Ø´Ù‡ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§/Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾â€ŒÙ‡Ø§
  loadGame();
});
// Ø°Ø®ÛŒØ±Ù‡ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ
setInterval(saveGame, 15000);
</script>
</body>
</html>
